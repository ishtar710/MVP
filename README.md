# PICASO-Trace2UML
MS AI 과제

> 트랜잭션ID/코릴레이션ID 기반 호출 로그/트레이스에서 단계·시스템 라벨을 자동 추출하여 PlantUML/Mermaid 시퀀스 다이어그램을 생성하고, 실패 지점/대안흐름(재시도·타임아웃 등)을 시각화한다. 실서비스 연동 없이 샘플/추출 로그만으로 동작하는 파일럿이다.
> - 시스템 호출 로그 기반 시퀀스다이어그램 자동생성   
> - 온보딩/분석 가시성 제고   

---

## 서비스 목표 및 범위

* 목표 : 개발 검증 시 초기 분석과 동일하게 개발되었는지 확인하고, 관리되지 않는 시스템 자료에 대해 쉽게 현행화 자료 생성을 목표로 함.
* 범위 : Skylife/HCN 가입·조회 플로우 중 1~2개 대표 시나리오.   
API GW/WAS 로그(또는 OpenTelemetry 추출본) ZIP 업로드 → 단일 페이지 UI에서 다이어그램 생성/내보내기.
* 비범위 : 실시간 스트리밍, 전체 모니터링 대체, 모든 시스템 포괄 자동화.

---

## 문제정의
| 문제 | 상세 설명 |
|------|-----------|
|복잡한 서비스 흐름|서비스 가입의 경우 kt 미디어플랫폼 시스템의 주요 시스템 6종을 연동하여 하나의 결과값을 리턴하는 것으로, 프로비저닝까지 하고 있어 전체적인 서비스 흐름은 한 눈에 파악하기 어려움|
|현행화 괸리|잦은 변화에 따른...|

---

## 아키텍처
1. **로그 수집**
   - API Gateway, WAS, 연동 시스템 로그 수집 (JSON, Text 등)
2. **전처리**
   - 타임스탬프 정렬, 호출 관계 추출, 불필요 로그 제거
3. **LLM 분석**
   - 호출 흐름 해석 → 시퀀스 다이어그램용 텍스트 생성 (예: PlantUML)
4. **RAG 연계**
   - 시스템 구조 문서, API 명세서와 비교하여 정확도 보정
5. **Embedding 분석**
   - 유사 흐름 클러스터링, 추천 시퀀스 제공
6. **시각화**
   - 시퀀스 다이어그램 생성 (웹 UI, PDF, HTML 등)

---

### 구성요소
| 구성 요소 | 역할 |
|-----------|------|
| **LLM** | 로그의 의미 해석, API 호출 간 관계 추론, 시퀀스 다이어그램 텍스트 생성 (예: PlantUML) |
| **RAG** | 시스템 구조 문서, API 명세서, 연동 흐름 문서 등과 연계하여 정확도 향상 |
| **Embedding** | 로그 벡터화 → 유사 흐름 군집화, 이상 흐름 탐지, 추천 흐름 제공 |


---

## 입력데이터 & 마스킹
### 입력 포맷(샘플 허용)
* API GW Access Log: NGINX/Envoy 포맷(+ X-Correlation-Id)   
* WAS App Log (JSON): timestamp, level, transactionid, spanId, service, endpoint, status, latencyMs, error   
* OpenTelemetry(선택): traceId, spanId, parentSpanId, attributes{peer.service, http.method, http.route, status}
### 마스킹 규칙(파일럿)
~~* 주민/전화/계약ID: 포맷보존 토큰화(FPE) 또는 해시+솔트(sha256(id+salt)[:10]).~~   
~~* 주소: 시/군/구까지 유지, 상세주소 토큰화.   
Payload: 바디 전체 저장 금지, 필드명·길이·타입 메타만 유지.~~

---
### 핵심 설계 요약
- 파이프라인: 업로드 → 전처리 → Parse(LLM) → RAG 보정(간단 문서 인덱스) → Generate(PlantUML, LLM) → Embedding 검색(유사 흐름) → UI 렌더링  
- LLM 사용 방식: Azure OpenAI 호출로 저온(deterministic) 추론(temperature 0–0.2).  
- Embedding: Azure OpenAI Embeddings API 사용, 벡터 저장은 Azure Cognitive Search(벡터 검색) 또는 간단히 로컬 FAISS(컨테이너) 사용.  
- 문서(시스템 구조): PoC용 최소 3개의 텍스트 스니펫(서비스 목록, API 매핑, 엔드포인트 표)만 인덱싱하여 RAG 보정에 사용.  
- 실행 전략: 모든 것을 가볍게 구성해 빠르게 반복 검증 — 서버리스(Functions) + Blob Storage + 간단 SPA.

---
## RAG 지식베이스(??)
* 컨텐츠 소스(샘플): 내부 시스템 설명 1p 요약, 엔드포인트 정의표, 에러코드 사전, 용어집.
* 임베딩 단위: 300~600 토큰 청크, 메타(system, endpoint, error_code).
* 질의 유형:
    * "/address/validate 는 무슨 역할?" → 라벨링 근거   
    * "GPV-9001 에러는?" → 실패 노트 텍스트

---
## UI/UX 초안 (streamlit)
* 상단: 파일 업로드(드래그&드롭) → 데이터셋 선택
* 좌측: 코릴레이션ID 리스트(검색/정렬: 시간, 실패 유무)
* 중앙: 다이어그램 미리보기(탭: 성공/실패/~~대안흐름~~)
* 우측: Step 패널(라벨·요약·p95·재시도·근거 링크)
* 하단: [Export PNG] [Export SVG] [Copy PlantUML]

### 🎯 기대 효과 정리

- 📉 **장애 분석 속도 향상**: 장애 발생 시 흐름 자동 시각화로 원인 파악 시간 단축
- 🧩 **신규 기능 설계 지원**: 기존 흐름과 유사한 시퀀스 추천으로 설계 효율화
- 🤝 **운영-개발 커뮤니케이션 개선**: 시각화된 흐름으로 협업 용이
- 🧠 **지식 자산화**: 로그 기반 흐름을 문서화하여 조직 내 기술 자산 축적

---

### 🌱 확장 아이디어

- 🔍 **이상 흐름 탐지**: 정상 시퀀스와 다른 흐름 자동 탐지 및 알림
- 🧪 **테스트 시나리오 자동 생성**: 시퀀스 기반 테스트 케이스 추출
- 🧭 **API 호출 시뮬레이터**: 시퀀스 다이어그램 기반 API 호출 시뮬레이션
